<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Visualizador de Mapas</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div class="container">
        <h1>Visualizador de Mapas Web</h1>
        <div style="margin-bottom: 20px;"></div>
        <form id="filtros" class="filtros" style="display: flex; flex-direction: column; gap: 12px;">
            <!-- üÜï SECCI√ìN DE B√öSQUEDA AVANZADA: Nombre/RFC + Direcci√≥n Cercana -->
            <div class="advanced-search-section">
                <div class="search-container">
                    <!-- B√∫squeda por Nombre/RFC -->
                    <div class="search-group">
                        <label class="search-label">üîç Buscar por Nombre/RFC:</label>
                        <input type="text" id="busqueda" name="busqueda" placeholder="Ej: Garc√≠a L√≥pez Juan" autocomplete="off" class="search-input">
                    </div>

                    <!-- B√∫squeda por Direcci√≥n Cercana -->
                    <div class="search-group">
                        <label class="search-label">üè† Buscar por Direcci√≥n Cercana:</label>
                        <div class="address-search-container">
                            <input type="text" id="address-search" placeholder="Ej: Centro, Ecatepec" autocomplete="off" class="address-input">
                            <select id="radius-search" class="radius-select">
                                <option value="1">1 km</option>
                                <option value="2">2 km</option>
                                <option value="3" selected>3 km</option>
                                <option value="5">5 km</option>
                                <option value="10">10 km</option>
                            </select>
                            <button type="button" id="search-nearby-btn" class="search-nearby-button" onclick="searchNearbyAddresses()">
                                üîç Buscar Cercanos
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- √Årea de selecciones activas (chips/tags) -->
            <div class="active-selections" id="activeSelections" style="display: none;">
                <div class="selection-header">
                    üéØ Filtros Activos:
                    <button type="button" class="clear-all-btn" onclick="clearAllChips()" title="Limpiar todos los filtros">
                        üóëÔ∏è Limpiar Todo
                    </button>
                </div>
                <div class="chips-container" id="chipsContainer">
                    <!-- Los chips se agregar√°n din√°micamente aqu√≠ -->
                </div>
            </div>

            <!-- Contenedor principal de filtros con bot√≥n a la derecha -->
            <div class="filters-container-horizontal">
                <!-- Filtros a la izquierda -->
                <div class="filters-left-section">
                    <!-- √Årea espacial - Panel izquierdo compacto -->
                    <div class="filter-section spatial-section">
                        <div class="section-header spatial-header">üìç Ubicaci√≥n</div>
                        <div class="horizontal-filters">
                            <div class="filter-item">
                                <div class="dropdown-container">
                                    <button type="button" class="dropdown-button spatial-button" data-filter="municipio">
                                        <span class="dropdown-text">üèõÔ∏è Municipio</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="dropdown-menu" id="municipio-dropdown">
                                        <div class="dropdown-search">
                                            <input type="text" placeholder="Buscar municipios..." class="dropdown-search-input">
                                        </div>
                                        <div class="dropdown-options" id="municipio-options">
                                            <!-- Opciones se cargar√°n din√°micamente -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-item">
                                <div class="dropdown-container">
                                    <button type="button" class="dropdown-button spatial-button" data-filter="cp">
                                        <span class="dropdown-text">üìÆ C√≥digo Postal</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="dropdown-menu" id="cp-dropdown">
                                        <div class="dropdown-search">
                                            <input type="text" placeholder="Buscar c√≥digos postales..." class="dropdown-search-input">
                                        </div>
                                        <div class="dropdown-options" id="cp-options">
                                            <!-- Opciones se cargar√°n din√°micamente -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- √Årea de datos y tiempo - Panel derecho compacto -->
                    <div class="filter-section data-section">
                        <div class="section-header data-header">üìä Datos</div>
                        <div class="horizontal-filters">
                            <div class="filter-item">
                                <div class="dropdown-container">
                                    <button type="button" class="dropdown-button" data-filter="idperiodo">
                                        <span class="dropdown-text">üìÖ Per√≠odo</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="dropdown-menu" id="idperiodo-dropdown">
                                        <div class="dropdown-options" id="idperiodo-options">
                                            <!-- Opciones se cargar√°n din√°micamente -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-item">
                                <div class="dropdown-container">
                                    <button type="button" class="dropdown-button" data-filter="idejercicio">
                                        <span class="dropdown-text">üìÜ A√±o</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="dropdown-menu" id="idejercicio-dropdown">
                                        <div class="dropdown-options" id="idejercicio-options">
                                            <!-- Opciones se cargar√°n din√°micamente -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-item">
                                <div class="dropdown-container">
                                    <button type="button" class="dropdown-button" data-filter="tipo">
                                        <span class="dropdown-text">üè∑Ô∏è Tipo</span>
                                        <span class="dropdown-arrow">‚ñº</span>
                                    </button>
                                    <div class="dropdown-menu" id="tipo-dropdown">
                                        <div class="dropdown-search">
                                            <input type="text" placeholder="Buscar tipos..." class="dropdown-search-input">
                                        </div>
                                        <div class="dropdown-options" id="tipo-options">
                                            <!-- Opciones se cargar√°n din√°micamente -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bot√≥n completamente a la derecha -->
                <div class="search-button-right">
                    <button type="submit" class="search-button">
                        <span class="button-icon">üîç</span>
                        Buscar Datos
                    </button>
                </div>
            </div>
        </form>
        <div id="map" style="margin-top: 24px;"></div>
        <div id="resultados" class="resultados"></div>
        <div id="loading" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; display:flex; align-items:center; justify-content:center; color:white; font-size:24px;">Cargando...</div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="/static/js/map.js"></script>
    <script src="/static/js/filtros.js"></script>
</body>
</html>
